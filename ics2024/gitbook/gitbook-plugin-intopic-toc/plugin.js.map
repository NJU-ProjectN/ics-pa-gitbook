{"version":3,"file":"plugin.js","sources":["../../src/book/plugin.js"],"sourcesContent":["/*global anchors,Gumshoe*/\nlet configuration;\nlet label;\n\nrequire(['gitbook', 'jQuery'], function (gitbook, $) {\n  anchors.options = {\n    placement: 'left'\n  };\n\n  gitbook.events.bind('start', function (e, config) {\n    configuration = config['intopic-toc'];\n    label = configuration.label;\n\n    // Label can be language specific and could be specified via user configuration\n    if (typeof label === 'object') {\n      const language = gitbook.state.innerLanguage;\n\n      if (language && Object.prototype.hasOwnProperty.call(label, language)) {\n        label = label[language];\n      } else {\n        label = '';\n      }\n    }\n\n    // Hide navigation if a search is ative\n    const $bookSearchResults = $('#book-search-results');\n\n    const observer = new MutationObserver(() => {\n      if ($bookSearchResults.hasClass('open')) {\n        $('.intopic-toc').hide();\n      }\n      else {\n        $('.intopic-toc').show();\n      }\n    });\n\n    observer.observe($bookSearchResults[0], { attributes: true });\n  });\n\n  gitbook.events.bind('page.change', function () {\n    anchors.removeAll();\n    anchors.add(configuration.selector);\n\n    const isVisible = (configuration.visible || gitbook.state.page.isTocVisible) && gitbook.state.page.isTocVisible !== false;\n\n    const mode = configuration.mode;\n    const maxDepth = Number(configuration.maxDepth);\n    const isCollapsed = Boolean(configuration.isCollapsed);\n    const isScrollspyActive = Boolean(configuration.isScrollspyActive);\n\n    if (anchors.elements.length > 1 && isVisible) {\n      const navigation = buildNavigation(anchors.elements, label, mode, maxDepth, isCollapsed);\n\n      const section = document.body.querySelector('.page-wrapper');\n      section.appendChild(navigation, section.firstChild);\n\n      if (isScrollspyActive) {\n        const container = $('.book-body .body-inner')[0];\n\n        new Gumshoe('.intopic-toc a', {\n          container: container,\n          navClass: 'active',\n          contentClass: 'active',\n          nested: true,\n          offset: container.offsetHeight / 2,\n          reflow: true\n        });\n      }\n    }\n  });\n});\n\nfunction getAnchorLevel(element) {\n  return parseInt(element.tagName.charAt(1), 10);\n}\n\nfunction createNavList(level) {\n  const navList = document.createElement('ul');\n  navList.classList.add('nav');\n  navList.classList.add('navbar-nav');\n  navList.classList.add(`level-${level}`);\n\n  return navList;\n}\n\nfunction createChildNavList(parent, level) {\n  const childList = createNavList(level);\n  parent.append(childList);\n\n  return childList;\n}\n\nfunction createNavItem(text, href) {\n  const anchor = document.createElement('a');\n  anchor.classList.add('nav-link');\n  anchor.text = text;\n  anchor.href = href;\n\n  const item = document.createElement('li');\n  item.appendChild(anchor);\n\n  return item;\n}\n\n/**\n * Find the index of first heading level (`<h1>`, then `<h2>`, etc.) that has more than one element.\n * Defaults to 0 for the first element.\n *\n * @param {*} elements Headings identified via selector config property\n */\nfunction getStartingElementIndex(elements) {\n  for (let i = 1; i <= 6; i++) {\n    const headings = elements.filter(x => x.tagName.toLowerCase() === `h${i}`);\n\n    if (headings.length > 1) {\n      return elements.indexOf(headings[0]);\n    }\n  }\n\n  return 0;\n}\n\nfunction buildNavigation(elements, header, mode, maxDepth, isCollapsed) {\n  const indentItems = mode.toLowerCase() === 'nested';\n  const navigation = document.createElement('nav');\n  navigation.className = `intopic-toc ${mode}`;\n\n  if (isCollapsed) {\n    navigation.className += ' collapsed';\n  }\n\n  const heading = document.createElement('h3');\n  heading.innerText = header;\n  navigation.appendChild(heading);\n\n  const containers = {};\n  containers[0] = createChildNavList(navigation, 0);\n\n  const startingElementIndex = getStartingElementIndex(elements);\n  const startingLevel = getAnchorLevel(elements[startingElementIndex]);\n\n  let previousItem;\n  let previousLevel = -1;\n\n  for (let i = startingElementIndex; i < elements.length; i++) {\n    const currentLevel = getAnchorLevel(elements[i]) - startingLevel;\n\n    if (currentLevel >= maxDepth) {\n      continue;\n    }\n\n    if (previousLevel === -1) {\n      previousLevel = currentLevel;\n    }\n\n    if (indentItems) {\n      if (currentLevel < previousLevel) {\n        for (let i = previousLevel; i > currentLevel; i--) {\n          delete containers[i];\n        }\n      }\n\n      if (!containers[currentLevel]) {\n        containers[currentLevel] = createChildNavList(previousItem, currentLevel);\n      }\n    }\n\n    const item = createNavItem(\n      elements[i].textContent,\n      elements[i].querySelector('.anchorjs-link').getAttribute('href'));\n\n    containers[indentItems ? currentLevel : 0].appendChild(item);\n\n    previousItem = item;\n    previousLevel = currentLevel;\n  }\n\n  return navigation;\n}\n"],"names":["configuration","label","getAnchorLevel","element","parseInt","tagName","charAt","createNavList","level","navList","document","createElement","classList","add","createChildNavList","parent","childList","append","createNavItem","text","href","anchor","item","appendChild","getStartingElementIndex","elements","i","headings","filter","x","toLowerCase","length","indexOf","buildNavigation","header","mode","maxDepth","isCollapsed","indentItems","navigation","className","heading","innerText","containers","previousItem","startingElementIndex","startingLevel","previousLevel","currentLevel","textContent","querySelector","getAttribute","require","gitbook","$","anchors","options","placement","events","bind","e","config","_typeof","language","state","innerLanguage","Object","prototype","hasOwnProperty","call","$bookSearchResults","MutationObserver","hasClass","hide","show","observe","attributes","removeAll","selector","isVisible","visible","page","isTocVisible","Number","Boolean","isScrollspyActive","section","body","firstChild","container","Gumshoe","navClass","contentClass","nested","offset","offsetHeight","reflow"],"mappings":"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"}